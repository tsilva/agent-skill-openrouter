"""Tests for {SERVER_NAME} tools."""

import json
import pytest
from unittest.mock import patch, MagicMock

from {PACKAGE_NAME}.server import example_tool, list_items


class TestExampleTool:
    """Tests for example_tool."""

    @patch("{PACKAGE_NAME}.server.get_client")
    def test_basic_search(self, mock_get_client):
        """Test basic search functionality."""
        mock_client = MagicMock()
        mock_client.search.return_value = {"results": [{"id": 1, "name": "test"}]}
        mock_get_client.return_value = mock_client

        result = example_tool("test query")

        mock_client.search.assert_called_once_with("test query", limit=10)
        parsed = json.loads(result)
        assert "results" in parsed

    @patch("{PACKAGE_NAME}.server.get_client")
    def test_with_limit(self, mock_get_client):
        """Test search with custom limit."""
        mock_client = MagicMock()
        mock_client.search.return_value = {"results": []}
        mock_get_client.return_value = mock_client

        example_tool("query", limit=5)

        mock_client.search.assert_called_once_with("query", limit=5)


class TestListItems:
    """Tests for list_items."""

    @patch("{PACKAGE_NAME}.server.get_client")
    def test_list_all(self, mock_get_client):
        """Test listing all items."""
        mock_client = MagicMock()
        mock_client.list_items.return_value = {"items": []}
        mock_get_client.return_value = mock_client

        result = list_items()

        mock_client.list_items.assert_called_once_with(category=None)
        parsed = json.loads(result)
        assert "items" in parsed

    @patch("{PACKAGE_NAME}.server.get_client")
    def test_with_category(self, mock_get_client):
        """Test listing with category filter."""
        mock_client = MagicMock()
        mock_client.list_items.return_value = {"items": []}
        mock_get_client.return_value = mock_client

        list_items(category="books")

        mock_client.list_items.assert_called_once_with(category="books")
